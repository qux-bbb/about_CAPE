# 安装相关

安装一定要开全局代理或者大陆白名单模式，因为好多内容要在github下载  

安装临时记录
```r
wget https://raw.githubusercontent.com/kevoreilly/CAPEv2/master/installer/kvm-qemu.sh
# 添加执行权限开始执行
chmod +x kvm-qemu.sh
sudo ./kvm-qemu.sh all cape | tee kvm-qemu.log 2>&1
# 安装virt-manager，用于后续安装配置虚机
sudo ./kvm-qemu.sh Virtmanager | tee kvm-qemu_virtmanager.log 2>&1

wget https://raw.githubusercontent.com/kevoreilly/CAPEv2/master/installer/cape2.sh
# 下载之后注意修改文件开头的一些变量: NETWORK_IFACE, IFACE_IP, PASSWD(如果不用tor，不要修改IFACE_IP), 然后添加执行权限开始执行
chmod +x cape2.sh
# cape账户是在这一步创建的
sudo ./cape2.sh base | tee cape.log 2>&1
```

之后就是配置虚机，调整配置文件，重启服务了  

## 错误记录处理
安装虚机错误  
```r
无法完成安装：'Failed to connect socket to '/var/run/libvirt/virtlogd-sock': 拒绝连接'

Traceback (most recent call last):
  File "/usr/share/virt-manager/virtManager/asyncjob.py", line 75, in cb_wrapper
    callback(asyncjob, *args, **kwargs)
  File "/usr/share/virt-manager/virtManager/createvm.py", line 2089, in _do_async_install
    guest.installer_instance.start_install(guest, meter=meter)
  File "/usr/share/virt-manager/virtinst/install/installer.py", line 542, in start_install
    domain = self._create_guest(
  File "/usr/share/virt-manager/virtinst/install/installer.py", line 491, in _create_guest
    domain = self.conn.createXML(install_xml or final_xml, 0)
  File "/usr/local/lib/python3.8/dist-packages/libvirt.py", line 4408, in createXML
    raise libvirtError('virDomainCreateXML() failed')
libvirt.libvirtError: Failed to connect socket to '/var/run/libvirt/virtlogd-sock': 拒绝连接

是libvirt错误，是因为没装好，重新装一下：  
sudo ./kvm-qemu.sh libvirt
```

安装错误  
```r
Unable to complete install: 'internal error: cannot load AppArmor profile 'libvirt-...
重装libvirt和apparmor:
sudo ./kvm-qemu.sh libvirt
sudo ./kvm-qemu.sh apparmor
```


## 觉得安装脚本可以改进的点  
```r
1. 不用apt，用apt-get

2. 
W: 目标 Sources (contrib/source/Sources) 在 /etc/apt/sources.list:63 和 /etc/apt/sources.list:64 中被配置了多次
也许可以放在目录下，而不是改文件
```
